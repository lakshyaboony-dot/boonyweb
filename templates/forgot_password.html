{% extends "base.html" %}
{% block title %}Forgot Password | Boony{% endblock %}
{% block content %}

<div class="astra-bg" style="min-height:100vh; display:flex; align-items:center; justify-content:center;">
    <div class="card" style="max-width:440px; width:100%; text-align:center;">

        {% if not step %}
        <h2 style="margin-bottom:10px;" id="forgotTitle">🔐 Forgot Password</h2>
        
        <!-- AI Guide Message -->
        {% if guide_message %}
        <div class="guide-message" style="background: var(--accent-color); color: var(--text-primary); padding: 12px; border-radius: 8px; margin-bottom: 16px; font-size: 14px; text-align: left;">
            <div style="display: flex; align-items: center; margin-bottom: 6px;">
                <span style="font-size: 18px; margin-right: 8px;">🤖</span>
                <strong>Boony Guide</strong>
            </div>
            <div>{{ guide_message }}</div>
        </div>
        {% endif %}
        
        <form method="POST" id="forgot-form">
            <input class="input" name="mobile" id="mobileInput" placeholder="Registered Mobile Number" required>
            <small class="hint" id="mobileHint">👉 Apna registered mobile number daalo (Enter your registered mobile)</small>
            <div style="height:16px"></div>
            
            <button class="btn-astra" type="submit" id="sendOtpButton">📱 Send OTP</button>
        </form>
        
        {% if error %}
        <p class="notice" style="margin-top:8px" id="errorMessage">{{ error }}</p>
        {% endif %}
        
        {% elif step == "verify" %}
        <h2 style="margin-bottom:10px;" id="verifyTitle">🔢 Verify OTP</h2>
        <p style="margin-bottom:16px; color: var(--text-secondary);" id="otpSentMessage">OTP sent to your mobile ending with {{ masked_mobile }}</p>
        
        <form method="POST" action="{{ url_for('reset_password') }}" id="verify-form">
            <input class="input" type="text" name="otp" id="otpInput" placeholder="Enter OTP" required>
            <small class="hint" id="otpHint">👉 SMS mein aaya OTP daalo (Enter the OTP from SMS)</small>
            <div style="height:12px"></div>
            
            <input class="input" type="password" name="new_password" id="newPasswordInput" placeholder="New Password" required>
            <small class="hint" id="passwordHint">👉 Naya password set karo (Set your new password)</small>
            <div style="height:16px"></div>
            
            <button class="btn-astra" type="submit" id="resetButton">🔄 Reset Password</button>
        </form>
        
        {% if error %}
        <p class="notice" style="margin-top:8px" id="errorMessage">{{ error }}</p>
        {% endif %}
        
        {% elif step == "reset" %}
        <h2 style="margin-bottom:10px;" id="resetTitle">🔄 Reset Password</h2>
        
        <form method="POST" id="reset-form">
            <input class="input" type="password" name="new_password" id="newPasswordInput" placeholder="New Password" required>
            <small class="hint" id="newPasswordHint">👉 Naya password daalo (Enter new password)</small>
            <div style="height:12px"></div>
            
            <input class="input" type="password" name="confirm_password" id="confirmPasswordInput" placeholder="Confirm Password" required>
            <small class="hint" id="confirmPasswordHint">👉 Password confirm karo (Confirm your password)</small>
            <div style="height:16px"></div>
            
            <button class="btn-astra" type="submit" id="confirmResetButton">✅ Confirm Reset</button>
        </form>
        
        {% if error %}
        <p class="notice" style="margin-top:8px" id="errorMessage">{{ error }}</p>
        {% endif %}
        
        {% endif %}
        
        <!-- Back to Login -->
        <div style="margin-top:16px;">
            <a href="{{ url_for('login') }}" class="forgot-link" id="backToLoginLink">🔙 Back to Login</a>
        </div>

    </div>
</div>

<style>
    .hint {
        display: block;
        font-size: 13px;
        color: #666;
        text-align: left;
        margin-top: 4px;
    }

    .forgot-link {
        font-size: 14px;
        color: #FF6B6B;
        text-decoration: underline;
        cursor: pointer;
        transition: color 0.3s ease;
    }

    .forgot-link:hover {
        color: #FF8E8E;
    }
</style>

<script>
    // Setup guide message TTS functionality
    function setupGuideMessageTTS() {
        const guideMessage = document.querySelector('.guide-message');
        
        if (guideMessage) {
            guideMessage.style.cursor = 'pointer';
            guideMessage.addEventListener('click', () => {
                const text = guideMessage.querySelector('div:last-child').textContent;
                if (window.speak) {
                    window.speak(text);
                }
            });
            
            // Auto-speak guide message on page load
            setTimeout(() => {
                const text = guideMessage.querySelector('div:last-child').textContent;
                if (window.speak) {
                    window.speak(text);
                }
            }, 1500);
        }
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        setupGuideMessageTTS();
    });
</script>

{% endblock %}
